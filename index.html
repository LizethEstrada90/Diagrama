<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.5, maximum-scale=2.0">
    <title>Diagrama Visual - Arquitectura Seguros Prevem</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --shadow-soft: 0 8px 32px rgba(31, 38, 135, 0.37);
            --shadow-hard: 0 15px 35px rgba(31, 38, 135, 0.5);
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --accent-blue: #3182ce;
            --accent-purple: #805ad5;
            --accent-green: #38a169;
            --accent-orange: #dd6b20;
            --accent-red: #e53e3e;
            
            /* Responsive scaling variables */
            --scale-factor: 1;
            --font-scale: 1;
            --spacing-scale: 1;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #3498db 0%, #2ecc71 50%, #27ae60 100%);
            min-height: 100vh;
            padding: clamp(8px, 2vw, 20px);
            overflow-x: auto;
            position: relative;
            font-size: clamp(14px, 2.5vw, 16px);
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(52, 152, 219, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(46, 204, 113, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(39, 174, 96, 0.2) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        /* Estilos del login */
        .login-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #3498db 0%, #2ecc71 50%, #27ae60 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 1;
            transition: opacity 0.8s ease, visibility 0.8s ease;
        }

        .login-container.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .login-box {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: clamp(20px, 4vw, 28px);
            box-shadow: var(--shadow-hard);
            padding: clamp(30px, 6vw, 50px);
            width: min(90vw, 400px);
            text-align: center;
            animation: slideInUp 0.8s ease-out;
        }

        .login-logo {
            font-size: clamp(2rem, 6vw, 3.5rem);
            margin-bottom: clamp(10px, 3vw, 20px);
        }

        .login-title {
            font-size: clamp(1.2rem, 4vw, 2rem);
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: clamp(8px, 2vw, 15px);
            background: linear-gradient(135deg, #3498db, #2ecc71, #27ae60);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }

        .login-subtitle {
            color: var(--text-secondary);
            font-size: clamp(0.8rem, 2vw, 1.1rem);
            margin-bottom: clamp(25px, 5vw, 40px);
            font-weight: 500;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: clamp(15px, 3vw, 20px);
        }

        .input-group {
            position: relative;
        }

        .login-input {
            width: 100%;
            padding: clamp(15px, 3vw, 18px) clamp(20px, 4vw, 24px);
            border: 2px solid rgba(52, 152, 219, 0.2);
            border-radius: clamp(12px, 2vw, 15px);
            font-size: clamp(0.9rem, 2.2vw, 1.1rem);
            background: rgba(255, 255, 255, 0.9);
            color: var(--text-primary);
            transition: all 0.3s ease;
            outline: none;
        }

        .login-input:focus {
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);
            background: white;
        }

        .login-input::placeholder {
            color: var(--text-secondary);
            font-weight: 400;
        }

        .input-icon {
            position: absolute;
            left: clamp(15px, 3vw, 20px);
            top: 50%;
            transform: translateY(-50%);
            font-size: clamp(1rem, 2.5vw, 1.3rem);
            color: var(--accent-blue);
            opacity: 0.7;
            pointer-events: none;
        }

        .login-input-with-icon {
            padding-left: clamp(45px, 9vw, 55px);
        }

        .login-btn {
            padding: clamp(15px, 3vw, 18px) clamp(25px, 5vw, 35px);
            border: none;
            border-radius: clamp(12px, 2vw, 15px);
            cursor: pointer;
            font-weight: 700;
            font-size: clamp(0.9rem, 2.2vw, 1.2rem);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: var(--success-gradient);
            color: white;
            margin-top: clamp(10px, 2vw, 15px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .login-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .login-btn:hover::before {
            left: 100%;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .login-btn:active {
            transform: translateY(-1px);
        }

        .login-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .error-message {
            color: var(--accent-red);
            font-size: clamp(0.8rem, 1.8vw, 0.95rem);
            margin-top: clamp(8px, 1.5vw, 10px);
            padding: clamp(8px, 1.5vw, 10px);
            background: rgba(229, 62, 62, 0.1);
            border-radius: 8px;
            border-left: 4px solid var(--accent-red);
            display: none;
            text-align: left;
        }

        .loading-spinner-login {
            width: clamp(16px, 3vw, 20px);
            height: clamp(16px, 3vw, 20px);
            border: 2px solid transparent;
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: none;
            margin-right: 8px;
        }

        .login-btn.loading .loading-spinner-login {
            display: inline-block;
        }

        .login-btn.loading {
            pointer-events: none;
        }

        /* Estilos del diagrama principal (existentes) */
        .diagram-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: clamp(16px, 3vw, 24px);
            box-shadow: var(--shadow-hard);
            padding: clamp(15px, 3vw, 35px);
            margin: 0 auto;
            max-width: min(1400px, 95vw);
            width: 100%;
            position: relative;
            animation: slideInUp 0.8s ease-out;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.8s ease, visibility 0.8s ease;
        }

        .diagram-container.visible {
            opacity: 1;
            visibility: visible;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .header {
            text-align: center;
            margin-bottom: clamp(20px, 4vw, 35px);
            padding: 0 clamp(10px, 3vw, 20px);
        }

        .header h1 {
            font-size: clamp(1.2rem, 4vw, 3rem);
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: clamp(8px, 2vw, 15px);
            background: linear-gradient(135deg, #3498db, #2ecc71, #27ae60);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
            letter-spacing: -0.02em;
            position: relative;
            word-break: break-word;
        }

        .header h1::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: clamp(40px, 8vw, 60px);
            height: clamp(3px, 0.5vw, 4px);
            background: linear-gradient(135deg, #3498db, #2ecc71, #27ae60);
            border-radius: 2px;
            animation: expandWidth 1s ease-out 0.5s both;
        }

        @keyframes expandWidth {
            from { width: 0; }
            to { width: clamp(40px, 8vw, 60px); }
        }

        .header p {
            color: var(--accent-blue);
            font-size: clamp(0.8rem, 2.2vw, 1.3rem);
            font-weight: 500;
            opacity: 0.9;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: clamp(8px, 2vw, 15px);
            margin-bottom: clamp(15px, 3vw, 25px);
            flex-wrap: wrap;
            padding: 0 clamp(8px, 2vw, 15px);
        }

        .control-btn {
            padding: clamp(12px, 2.5vw, 16px) clamp(20px, 4vw, 32px);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-size: clamp(0.8rem, 2.2vw, 1.1rem);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 0.3px;
            min-width: clamp(160px, 28vw, 220px);
            white-space: nowrap;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            flex: 1;
            max-width: 280px;
            text-align: center;
            line-height: 1.2;
        }

        .control-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .control-btn:hover::before {
            left: 100%;
        }

        .btn-current {
            background: var(--success-gradient);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-future {
            background: var(--warning-gradient);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-both {
            background: var(--secondary-gradient);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .control-btn:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .control-btn:active {
            transform: translateY(-1px) scale(1.01);
        }

        .sidebar-container {
            display: flex;
            flex-wrap: wrap;
            gap: clamp(12px, 3vw, 20px);
            margin-bottom: clamp(15px, 3vw, 25px);
            justify-content: center;
        }

        .legend, .phase-indicator {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            padding: clamp(12px, 3vw, 20px);
            border-radius: clamp(12px, 2vw, 16px);
            flex: 1;
            min-width: min(250px, 90vw);
            max-width: 400px;
            box-shadow: var(--shadow-soft);
            transition: all 0.3s ease;
        }

        .legend:hover, .phase-indicator:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hard);
        }

        .legend h3, .phase-indicator h3 {
            color: var(--text-primary);
            margin-bottom: clamp(12px, 2.5vw, 18px);
            text-align: center;
            font-size: clamp(0.9rem, 2.2vw, 1.2rem);
            font-weight: 700;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: clamp(8px, 1.5vw, 12px);
            padding: clamp(6px, 1.2vw, 8px);
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .legend-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(3px);
        }

        .legend-color {
            width: clamp(20px, 4vw, 24px);
            height: clamp(3px, 0.6vw, 4px);
            margin-right: clamp(10px, 2vw, 15px);
            border-radius: 2px;
            flex-shrink: 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .legend-text {
            font-size: clamp(0.7rem, 1.6vw, 1rem);
            color: var(--text-secondary);
            font-weight: 500;
            line-height: 1.3;
        }

        .phase-current, .phase-future {
            color: white;
            padding: clamp(8px, 2vw, 12px) clamp(12px, 3vw, 20px);
            border-radius: 25px;
            font-weight: 700;
            margin-bottom: clamp(10px, 2vw, 15px);
            text-align: center;
            font-size: clamp(0.8rem, 1.8vw, 1.1rem);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .phase-current {
            background: var(--success-gradient);
        }

        .phase-future {
            background: var(--warning-gradient);
        }

        .phase-current::before, .phase-future::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .diagram-wrapper {
            width: 100%;
            overflow-x: auto;
            overflow-y: hidden;
            border: 1px solid var(--glass-border);
            border-radius: clamp(16px, 2.5vw, 20px);
            background: 
                linear-gradient(45deg, rgba(255, 255, 255, 0.9) 0%, rgba(248, 250, 252, 0.9) 100%),
                url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23f0f4f8' fill-opacity='0.4'%3E%3Ccircle cx='7' cy='7' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06);
            position: relative;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
        }

        .diagram-wrapper::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, 
                rgba(102, 126, 234, 0.05) 0%, 
                rgba(118, 75, 162, 0.05) 50%, 
                rgba(240, 147, 251, 0.05) 100%);
            border-radius: clamp(16px, 2.5vw, 20px);
            pointer-events: none;
        }

        .diagram-svg {
            width: 100%;
            min-width: clamp(600px, 120vw, 1200px);
            height: auto;
            min-height: clamp(400px, 60vh, 800px);
            display: block;
            position: relative;
            z-index: 1;
        }

        /* Elementos SVG responsive */
        .site-box {
            fill: none;
            stroke-width: clamp(2px, 0.4vw, 3px);
            rx: clamp(15px, 2vw, 20px);
            filter: drop-shadow(0 8px 25px rgba(0, 0, 0, 0.15));
            transition: all 0.3s ease;
        }

        .site-box:hover {
            filter: drop-shadow(0 12px 35px rgba(0, 0, 0, 0.25));
        }

        .site-cdmx { 
            stroke: var(--accent-blue); 
            stroke-dasharray: 5, 5;
            animation: dashMove 20s linear infinite;
        }
        .site-sur { 
            stroke: var(--accent-orange);
            stroke-dasharray: 8, 4;
            animation: dashMove 15s linear infinite reverse;
        }
        .site-leon { 
            stroke: var(--accent-green);
            stroke-dasharray: 10, 6;
            animation: dashMove 25s linear infinite;
        }

        @keyframes dashMove {
            to {
                stroke-dashoffset: 1000;
            }
        }

        .site-title {
            font-size: clamp(11px, 1.4vw, 20px);
            font-weight: 800;
            text-anchor: middle;
            fill: var(--text-primary);
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }

        .server-box {
            fill: rgba(255, 255, 255, 0.9);
            stroke-width: clamp(1.5px, 0.3vw, 2.5px);
            rx: clamp(8px, 1.5vw, 12px);
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.15));
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .server-box:hover {
            filter: drop-shadow(0 8px 25px rgba(0, 0, 0, 0.25));
            transform: scale(1.05) translateY(-1px);
        }

        .server-prod { 
            stroke: var(--accent-red); 
            fill: rgba(229, 62, 62, 0.1);
            animation: pulse-red 3s ease-in-out infinite;
        }
        .server-dev { 
            stroke: var(--accent-blue); 
            fill: rgba(49, 130, 206, 0.1);
            animation: pulse-blue 3s ease-in-out infinite 0.5s;
        }
        .server-drp { 
            stroke: var(--accent-orange); 
            fill: rgba(221, 107, 32, 0.1);
            animation: pulse-orange 3s ease-in-out infinite 1s;
        }
        .server-new { 
            stroke: var(--accent-green); 
            fill: rgba(56, 161, 105, 0.1);
            animation: pulse-green 3s ease-in-out infinite 1.5s;
        }

        @keyframes pulse-red {
            0%, 100% { box-shadow: 0 0 0 0 rgba(229, 62, 62, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(229, 62, 62, 0); }
        }

        @keyframes pulse-blue {
            0%, 100% { box-shadow: 0 0 0 0 rgba(49, 130, 206, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(49, 130, 206, 0); }
        }

        @keyframes pulse-orange {
            0%, 100% { box-shadow: 0 0 0 0 rgba(221, 107, 32, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(221, 107, 32, 0); }
        }

        @keyframes pulse-green {
            0%, 100% { box-shadow: 0 0 0 0 rgba(56, 161, 105, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(56, 161, 105, 0); }
        }

        .server-text {
            font-size: clamp(7px, 1vw, 13px);
            font-weight: 600;
            text-anchor: middle;
            fill: var(--text-primary);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
        }

        .app-circle {
            fill: rgba(255, 255, 255, 0.95);
            stroke-width: clamp(2px, 0.4vw, 3px);
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.2));
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .app-circle:hover {
            filter: drop-shadow(0 8px 25px rgba(0, 0, 0, 0.3));
            transform: scale(1.1);
        }

        .app-axel { 
            stroke: var(--accent-red); 
            fill: rgba(229, 62, 62, 0.1);
        }
        .app-insurance { 
            stroke: var(--accent-purple); 
            fill: rgba(128, 90, 213, 0.1);
        }
        .app-mesa { 
            stroke: var(--accent-green); 
            fill: rgba(56, 161, 105, 0.1);
        }

        .app-text {
            font-size: clamp(8px, 1.2vw, 14px);
            font-weight: 700;
            text-anchor: middle;
            fill: var(--text-primary);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
        }

        .connection-line {
            stroke-width: clamp(2px, 0.4vw, 3px);
            fill: none;
            opacity: 0.8;
            transition: all 0.3s ease;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }

        .connection-line:hover {
            stroke-width: clamp(3px, 0.6vw, 5px);
            opacity: 1;
        }

        .connection-primary { 
            stroke: var(--accent-red);
            stroke-linecap: round;
        }
        .connection-secondary { 
            stroke: var(--accent-blue);
            stroke-linecap: round;
        }
        .connection-drp { 
            stroke: var(--accent-orange); 
            stroke-dasharray: 8, 4;
            stroke-linecap: round;
            animation: dashFlow 3s linear infinite;
        }
        .connection-future { 
            stroke: var(--accent-green); 
            stroke-dasharray: 12, 6;
            stroke-linecap: round;
            animation: dashFlow 2s linear infinite reverse;
        }

        @keyframes dashFlow {
            to {
                stroke-dashoffset: 100;
            }
        }

        .info-panel {
            position: fixed;
            bottom: clamp(15px, 3vw, 25px);
            left: clamp(15px, 3vw, 25px);
            right: clamp(15px, 3vw, 25px);
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            padding: clamp(15px, 3vw, 20px);
            border-radius: clamp(12px, 2vw, 16px);
            max-width: min(450px, 90vw);
            display: none;
            z-index: 1000;
            box-shadow: var(--shadow-hard);
            margin: 0 auto;
            animation: slideInUp 0.3s ease-out;
            max-height: 60vh;
            overflow-y: auto;
        }

        .info-panel h3 {
            color: var(--text-primary);
            margin-bottom: clamp(10px, 2vw, 15px);
            font-size: clamp(0.9rem, 2.2vw, 1.2rem);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: clamp(8px, 1.5vw, 10px);
        }

        .info-panel h3::before {
            content: 'üîç';
            font-size: 1.2em;
        }

        .info-panel p {
            font-size: clamp(0.7rem, 1.6vw, 0.95rem);
            color: var(--text-secondary);
            margin-bottom: clamp(6px, 1.2vw, 8px);
            line-height: 1.4;
            padding-left: clamp(10px, 2vw, 15px);
            position: relative;
        }

        .info-panel p::before {
            content: '‚Ä¢';
            color: var(--accent-blue);
            position: absolute;
            left: 0;
            font-weight: bold;
        }

        .info-panel button {
            margin-top: clamp(8px, 1.5vw, 10px);
            padding: clamp(6px, 1.2vw, 8px) clamp(12px, 2.5vw, 16px);
            background: var(--accent-blue);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: clamp(0.7rem, 1.4vw, 0.8rem);
            transition: all 0.3s ease;
        }

        .info-panel button:hover {
            background: var(--accent-purple);
            transform: translateY(-1px);
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: clamp(8px, 1.5vw, 12px) clamp(10px, 2vw, 16px);
            border-radius: clamp(8px, 1.5vw, 12px);
            font-size: clamp(0.7rem, 1.4vw, 0.9rem);
            pointer-events: none;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            max-width: min(250px, 80vw);
            word-wrap: break-word;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.9);
        }

        .user-icon {
            fill: var(--accent-blue);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .user-icon:hover {
            fill: var(--accent-purple);
            transform: scale(1.2);
        }

        .cloud-icon {
            fill: var(--accent-purple);
            opacity: 0.8;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .status-indicator {
            animation: statusPulse 2s ease-in-out infinite;
        }

        @keyframes statusPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .performance-metrics {
            position: relative;
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            padding: clamp(10px, 2vw, 15px);
            border-radius: clamp(8px, 1.5vw, 12px);
            font-size: clamp(0.7rem, 1.4vw, 0.8rem);
            color: var(--text-secondary);
            margin-bottom: clamp(10px, 2vw, 15px);
            width: 100%;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
            z-index: 10;
        }

        .metric-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: clamp(6px, 1.2vw, 8px);
            align-items: center;
        }

        .metric-value {
            font-weight: 600;
            color: var(--accent-green);
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: clamp(16px, 2.5vw, 20px);
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .loading-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .loading-spinner {
            width: clamp(30px, 6vw, 50px);
            height: clamp(30px, 6vw, 50px);
            border: clamp(2px, 0.4vw, 4px) solid var(--glass-border);
            border-top: clamp(2px, 0.4vw, 4px) solid var(--accent-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Security indicators */
        .security-badge {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success-gradient);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 999;
            display: none;
        }

        .security-badge.authenticated {
            display: block;
            animation: slideInDown 0.5s ease-out;
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .logout-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--accent-red);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 999;
            display: none;
            transition: all 0.3s ease;
        }

        .logout-btn.visible {
            display: block;
        }

        .logout-btn:hover {
            background: var(--accent-orange);
            transform: translateY(-1px);
        }

        /* Estilos espec√≠ficos para m√≥viles */
        @media (max-width: 480px) {
            body {
                padding: 8px;
                font-size: 14px;
            }

            .login-box {
                padding: 25px;
                width: 95vw;
            }

            .diagram-container {
                padding: 15px;
                border-radius: 16px;
            }

            .header {
                margin-bottom: 20px;
            }

            .header h1 {
                font-size: 1.4rem;
                line-height: 1.3;
            }

            .header p {
                font-size: 0.9rem;
            }

            .controls {
                flex-direction: column;
                align-items: center;
                gap: 10px;
                margin-bottom: 15px;
            }

            .control-btn {
                width: 100%;
                max-width: 300px;
                padding: 14px 20px;
                font-size: 0.9rem;
                min-width: auto;
                line-height: 1.3;
            }

            .sidebar-container {
                flex-direction: column;
                gap: 10px;
                margin-bottom: 15px;
            }

            .legend, .phase-indicator {
                min-width: auto;
                max-width: none;
                padding: 12px;
            }

            .diagram-svg {
                min-width: 500px;
                min-height: 350px;
            }

            .info-panel {
                bottom: 10px;
                left: 10px;
                right: 10px;
                padding: 12px;
                max-width: none;
                max-height: 50vh;
            }

            .performance-metrics {
                position: relative;
                margin-bottom: 10px;
                max-width: none;
            }

            .security-badge, .logout-btn {
                top: 10px;
                font-size: 0.7rem;
                padding: 6px 12px;
            }

            .logout-btn {
                left: 10px;
            }

            .security-badge {
                right: 10px;
            }
        }

        /* Print styles */
        @media print {
            .login-container,
            .security-badge,
            .logout-btn,
            .controls,
            .info-panel,
            .tooltip,
            .loading-overlay {
                display: none !important;
            }

            body {
                background: white;
                color: black;
                padding: 0;
            }

            .diagram-container {
                background: white;
                box-shadow: none;
                border: 1px solid #ccc;
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <!-- Login Container -->
    <div class="login-container" id="loginContainer">
        <div class="login-box">
            <div class="login-logo">üè¢</div>
            <h1 class="login-title">Prevem Seguros</h1>
            <p class="login-subtitle">Acceso Seguro - Diagrama de Arquitectura</p>
            
            <form class="login-form" id="loginForm">
                <div class="input-group">
                    <div class="input-icon">üë§</div>
                    <input 
                        type="text" 
                        class="login-input login-input-with-icon" 
                        id="username"
                        placeholder="Usuario"
                        required
                        autocomplete="username"
                        maxlength="20"
                    >
                </div>
                
                <div class="input-group">
                    <div class="input-icon">üîí</div>
                    <input 
                        type="password" 
                        class="login-input login-input-with-icon" 
                        id="password"
                        placeholder="Contrase√±a"
                        required
                        autocomplete="current-password"
                        maxlength="20"
                    >
                </div>
                
                <button type="submit" class="login-btn" id="loginBtn">
                    <div class="loading-spinner-login" id="loginSpinner"></div>
                    <span id="loginBtnText">üöÄ Acceder al Sistema</span>
                </button>
                
                <div class="error-message" id="errorMessage">
                    <strong>‚ö†Ô∏è Error de Autenticaci√≥n</strong><br>
                    Usuario o contrase√±a incorrectos. Verifique sus credenciales.
                </div>
            </form>
        </div>
    </div>

    <!-- Security Badge -->
    <div class="security-badge" id="securityBadge">
        üîí Sesi√≥n Autenticada
    </div>

    <!-- Logout Button -->
    <button class="logout-btn" id="logoutBtn">
        üö™ Cerrar Sesi√≥n
    </button>

    <!-- Main Diagram Container -->
    <div class="diagram-container" id="diagramContainer">
        <div class="performance-metrics" id="performanceMetrics">
            <div class="metric-item">
                <span>Servidores:</span>
                <span class="metric-value" id="serverCount">4</span>
            </div>
            <div class="metric-item">
                <span>Aplicaciones:</span>
                <span class="metric-value" id="appCount">3</span>
            </div>
            <div class="metric-item">
                <span>Conexiones:</span>
                <span class="metric-value" id="connectionCount">7</span>
            </div>
            <div class="metric-item">
                <span>Estado:</span>
                <span class="metric-value" id="systemStatus">Operativo</span>
            </div>
        </div>

        <div class="header">
            <h1>Diagrama de Infraestructura Prevem Seguros</h1>
            <p>Situaci√≥n Actual vs Plan DRP/BCP Le√≥n</p>
        </div>

        <div class="controls">
            <button class="control-btn btn-current" onclick="showView('current')" data-view="current" aria-label="Mostrar estado actual del sistema">
                üìç Estado Actual
            </button>
            <button class="control-btn btn-future" onclick="showView('future')" data-view="future" aria-label="Mostrar plan futuro del sistema">
                üéØ Plan Futuro
            </button>
            <button class="control-btn btn-both" onclick="showView('both')" data-view="both" aria-label="Mostrar migraci√≥n completa">
                üîÑ Migraci√≥n Completa
            </button>
        </div>

        <div class="sidebar-container">
            <div class="phase-indicator" id="phaseIndicator">
                <div class="phase-current">FASE ACTUAL</div>
                <div style="color: var(--text-secondary); font-size: clamp(0.7rem, 1.5vw, 0.9rem); margin-top: 8px;">Assessment y Documentaci√≥n</div>
            </div>

            <div class="legend">
                <h3>üóÇÔ∏è Leyenda</h3>
                <div class="legend-item">
                    <div class="legend-color" style="background: var(--accent-red);"></div>
                    <span class="legend-text">Conexi√≥n Principal</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: var(--accent-blue);"></div>
                    <span class="legend-text">Conexi√≥n Secundaria</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: repeating-linear-gradient(90deg, var(--accent-orange) 0, var(--accent-orange) 8px, transparent 8px, transparent 12px);"></div>
                    <span class="legend-text">Replicaci√≥n DRP</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: repeating-linear-gradient(90deg, var(--accent-green) 0, var(--accent-green) 12px, transparent 12px, transparent 18px);"></div>
                    <span class="legend-text">Plan Futuro</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: var(--accent-purple);"></div>
                    <span class="legend-text">Internet/Cloud</span>
                </div>
            </div>
        </div>

        <div class="info-panel" id="infoPanel" role="dialog" aria-labelledby="infoTitle" aria-hidden="true">
            <h3 id="infoTitle">Informaci√≥n</h3>
            <div id="infoContent"></div>
            <button onclick="hideInfo()" aria-label="Cerrar panel de informaci√≥n">Cerrar</button>
        </div>

        <div class="diagram-wrapper" role="img" aria-label="Diagrama de arquitectura de sistemas Prevem Seguros">
            <div class="loading-overlay" id="loadingOverlay" aria-hidden="true">
                <div class="loading-spinner" aria-label="Cargando"></div>
            </div>

            <svg class="diagram-svg" viewBox="0 0 1200 800" preserveAspectRatio="xMidYMid meet" role="img" aria-labelledby="diagram-title">
                <title id="diagram-title">Arquitectura de Sistemas Prevem Seguros - Estado Actual y Plan Futuro</title>
                <defs>
                    <marker id="arrowhead" markerWidth="12" markerHeight="9" refX="11" refY="4.5" orient="auto">
                        <polygon points="0 0, 12 4.5, 0 9" fill="var(--text-primary)" />
                    </marker>
                    <marker id="arrowhead-green" markerWidth="12" markerHeight="9" refX="11" refY="4.5" orient="auto">
                        <polygon points="0 0, 12 4.5, 0 9" fill="var(--accent-green)" />
                    </marker>
                    <linearGradient id="serverGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:rgba(255,255,255,0.9);stop-opacity:1" />
                        <stop offset="100%" style="stop-color:rgba(248,250,252,0.9);stop-opacity:1" />
                    </linearGradient>
                    <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
                        <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
                        <feMerge> 
                            <feMergeNode in="coloredBlur"/>
                            <feMergeNode in="SourceGraphic"/>
                        </feMerge>
                    </filter>
                    <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
                        <feDropShadow dx="0" dy="4" stdDeviation="8" flood-color="rgba(0,0,0,0.1)"/>
                    </filter>
                </defs>

                <!-- Background patterns -->
                <defs>
                    <pattern id="dots" patternUnits="userSpaceOnUse" width="20" height="20">
                        <circle cx="10" cy="10" r="1" fill="rgba(102, 126, 234, 0.1)"/>
                    </pattern>
                </defs>
                <rect width="100%" height="100%" fill="url(#dots)" opacity="0.3"/>

                <!-- Internet Cloud -->
                <g class="cloud-section">
                    <ellipse cx="600" cy="50" rx="90" ry="30" class="cloud-icon" filter="url(#shadow)"/>
                    <text x="600" y="58" class="site-title" style="font-size: 16px; fill: #000000; font-weight: 700;">‚òÅÔ∏è Internet</text>
                </g>

                <!-- Ciudad de M√©xico - Matriz -->
                <g class="site-cdmx-group" id="siteCDMX">
                    <rect x="50" y="120" width="500" height="300" class="site-box site-cdmx" filter="url(#shadow)"/>
                    <text x="300" y="145" class="site-title">üè¢ Ciudad de M√©xico - Matriz</text>
                    
                    <!-- Servidor Producci√≥n X9 -->
                    <g class="server-group" data-info="prod-server" tabindex="0" role="button" aria-label="Servidor de Producci√≥n X9">
                        <rect x="80" y="170" width="120" height="80" class="server-box server-prod" fill="url(#serverGradient)"/>
                        <text x="140" y="190" class="server-text">üñ•Ô∏è Servidor X9</text>
                        <text x="140" y="205" class="server-text">PRODUCCI√ìN</text>
                        <text x="140" y="220" class="server-text">Oracle 19c</text>
                        <text x="140" y="235" class="server-text">Acsel Core</text>
                        <circle cx="190" cy="180" r="4" class="status-indicator" fill="var(--accent-green)"/>
                    </g>

                    <!-- Servidor Desarrollo X9 -->
                    <g class="server-group" data-info="dev-server" tabindex="0" role="button" aria-label="Servidor de Desarrollo X9">
                        <rect x="220" y="170" width="120" height="80" class="server-box server-dev" fill="url(#serverGradient)"/>
                        <text x="280" y="190" class="server-text">üñ•Ô∏è Servidor X9</text>
                        <text x="280" y="205" class="server-text">DEV/QA</text>
                        <text x="280" y="220" class="server-text">Oracle 19c</text>
                        <text x="280" y="235" class="server-text">Testing</text>
                        <circle cx="330" cy="180" r="4" class="status-indicator" fill="var(--accent-blue)"/>
                    </g>

                    <!-- Servidores de Aplicaciones -->
                    <g class="app-servers" tabindex="0" role="button" aria-label="Servidores de Aplicaciones">
                        <rect x="360" y="170" width="100" height="60" class="server-box" style="stroke: var(--accent-green); fill: url(#serverGradient);"/>
                        <text x="410" y="190" class="server-text">üñ•Ô∏è App Servers</text>
                        <text x="410" y="205" class="server-text">Windows</text>
                        <text x="410" y="220" class="server-text">Insurance/Mesa</text>
                        <circle cx="450" cy="180" r="4" class="status-indicator" fill="var(--accent-green)"/>
                    </g>

                    <!-- Aplicaciones -->
                    <g class="applications-cdmx">
                        <circle cx="140" cy="320" r="35" class="app-circle app-axel" data-info="axel-app" filter="url(#shadow)" tabindex="0" role="button" aria-label="Aplicaci√≥n ACSEL"/>
                        <text x="140" y="325" class="app-text">ACSEL</text>
                        
                        <circle cx="240" cy="320" r="35" class="app-circle app-insurance" data-info="insurance-app" filter="url(#shadow)" tabindex="0" role="button" aria-label="Aplicaci√≥n Insurance"/>
                        <text x="240" y="318" class="app-text" style="font-size: 11px;">Insurance</text>
                        <text x="240" y="330" class="app-text" style="font-size: 11px;">(Siniestros)</text>
                        
                        <circle cx="340" cy="320" r="35" class="app-circle app-mesa" data-info="mesa-app" filter="url(#shadow)" tabindex="0" role="button" aria-label="Aplicaci√≥n Mesa de Control"/>
                        <text x="340" y="318" class="app-text" style="font-size: 11px;">Mesa</text>
                        <text x="340" y="330" class="app-text" style="font-size: 11px;">Control</text>
                    </g>

                    <!-- Usuarios -->
                    <g class="users-group">
                        <text x="460" y="290" class="server-text">üë• Usuarios</text>
                        <circle cx="440" cy="310" r="8" class="user-icon" data-info="users-internal" tabindex="0" role="button" aria-label="Usuarios internos"/>
                        <circle cx="460" cy="310" r="8" class="user-icon" data-info="users-internal" tabindex="0" role="button" aria-label="Usuarios internos"/>
                        <circle cx="480" cy="310" r="8" class="user-icon" data-info="users-internal" tabindex="0" role="button" aria-label="Usuarios internos"/>
                        <text x="460" y="340" class="app-text">VPN/Web Access</text>
                    </g>
                </g>

                <!-- San Jer√≥nimo - DRP Actual -->
                <g class="site-sur-group" id="siteSur">
                    <rect x="50" y="480" width="350" height="150" class="site-box site-sur" filter="url(#shadow)"/>
                    <text x="225" y="505" class="site-title">üè¢ San Jer√≥nimo - DRP Actual</text>
                    
                    <!-- Servidor X7 DRP -->
                    <g class="server-group" data-info="drp-current" tabindex="0" role="button" aria-label="Servidor DRP Actual X7">
                        <rect x="80" y="530" width="120" height="70" class="server-box server-drp" fill="url(#serverGradient)"/>
                        <text x="140" y="550" class="server-text">üñ•Ô∏è Servidor X7</text>
                        <text x="140" y="565" class="server-text">DRP ACTUAL</text>
                        <text x="140" y="580" class="server-text">Oracle Replica</text>
                        <text x="140" y="595" class="server-text">Standby</text>
                        <circle cx="190" cy="540" r="4" class="status-indicator" fill="var(--accent-orange)"/>
                    </g>

                    <!-- Status DRP -->
                    <g>
                        <text x="250" y="540" class="server-text">üìä Estado:</text>
                        <text x="250" y="555" class="server-text">Replicando</text>
                        <text x="250" y="575" class="server-text">‚ö†Ô∏è Capacidad</text>
                        <text x="250" y="590" class="server-text">Limitada</text>
                    </g>
                </g>

                <!-- Le√≥n - Plan Futuro -->
                <g class="site-leon-group" id="siteLeon" style="opacity: 0.5;">
                    <rect x="650" y="200" width="500" height="400" class="site-box site-leon" filter="url(#shadow)"/>
                    <text x="900" y="225" class="site-title">üéØ Le√≥n - Plan DRP/BCP</text>
                    
                    <!-- Nuevos Servidores Le√≥n -->
                    <g class="server-group" data-info="leon-new" tabindex="0" role="button" aria-label="Nuevos Servidores Le√≥n">
                        <rect x="680" y="260" width="140" height="90" class="server-box server-new" fill="url(#serverGradient)"/>
                        <text x="750" y="280" class="server-text">üñ•Ô∏è Servidores Nuevos</text>
                        <text x="750" y="295" class="server-text">DRP PRINCIPAL</text>
                        <text x="750" y="310" class="server-text">Oracle 19c</text>
                        <text x="750" y="325" class="server-text">Alta Capacidad</text>
                        <text x="750" y="340" class="server-text">Dell (Polo Deal)</text>
                        <circle cx="810" cy="270" r="4" class="status-indicator" fill="var(--accent-green)" style="opacity: 0.5;"/>
                    </g>

                    <!-- Aplicaciones Replicadas -->
                    <g class="applications-leon">
                        <circle cx="750" cy="400" r="40" class="app-circle app-axel" data-info="axel-leon" filter="url(#shadow)" tabindex="0" role="button" aria-label="ACSEL Le√≥n"/>
                        <text x="750" y="403" class="app-text" style="font-size: 11px;">ACSEL</text>
                        <text x="750" y="415" class="app-text" style="font-size: 10px;">REPLICA</text>
                        
                        <circle cx="850" cy="400" r="40" class="app-circle app-insurance" data-info="insurance-leon" filter="url(#shadow)" tabindex="0" role="button" aria-label="Insurance Le√≥n"/>
                        <text x="850" y="398" class="app-text" style="font-size: 10px;">Insurance</text>
                        <text x="850" y="410" class="app-text" style="font-size: 10px;">REPLICA</text>
                        
                        <circle cx="950" cy="400" r="40" class="app-circle app-mesa" data-info="mesa-leon" filter="url(#shadow)" tabindex="0" role="button" aria-label="Mesa Le√≥n"/>
                        <text x="950" y="398" class="app-text" style="font-size: 11px;">Mesa</text>
                        <text x="950" y="410" class="app-text" style="font-size: 10px;">REPLICA</text>
                    </g>

                    <!-- Conectividad Le√≥n -->
                    <g class="connectivity-leon">
                        <rect x="680" y="480" width="200" height="60" class="server-box" style="stroke: var(--accent-purple); fill: url(#serverGradient);"/>
                        <text x="780" y="505" class="server-text">üåê Conectividad</text>
                        <text x="780" y="520" class="server-text">Enlace Dedicado</text>
                        <text x="780" y="535" class="server-text">(Por Contratar)</text>
                    </g>

                    <!-- Caracter√≠sticas BCP -->
                    <g class="bcp-features">
                        <text x="900" y="260" class="server-text" style="font-weight: bold; fill: var(--accent-green);">‚úÖ Caracter√≠sticas BCP:</text>
                        <text x="900" y="275" class="server-text">‚Ä¢ Continuidad Total</text>
                        <text x="900" y="290" class="server-text">‚Ä¢ Failover Autom√°tico</text>
                        <text x="900" y="305" class="server-text">‚Ä¢ Reverse Proxy</text>
                        <text x="900" y="320" class="server-text">‚Ä¢ Cumplimiento CNSF</text>
                        <text x="900" y="335" class="server-text">‚Ä¢ Performance Escalable</text>
                    </g>
                </g>

                <!-- Conexiones Actuales -->
                <g class="connections-current" id="currentConnections">
                    <path d="M600,75 Q450,90 300,120" class="connection-line connection-primary" style="animation-delay: 0.5s;" marker-end="url(#arrowhead)"/>
                    <line x1="140" y1="250" x2="140" y2="295" class="connection-line connection-primary" style="animation-delay: 1s;" marker-end="url(#arrowhead)"/>
                    <path d="M200,210 Q220,250 240,295" class="connection-line connection-secondary" style="animation-delay: 1.2s;" marker-end="url(#arrowhead)"/>
                    <path d="M360,200 Q350,250 340,295" class="connection-line connection-secondary" style="animation-delay: 1.4s;" marker-end="url(#arrowhead)"/>
                    <path d="M440,310 Q400,315 365,320" class="connection-line connection-secondary" style="animation-delay: 1.6s;" marker-end="url(#arrowhead)"/>
                    <path d="M140,250 Q90,350 140,530" class="connection-line connection-drp" style="animation-delay: 2s;" marker-end="url(#arrowhead)"/>
                </g>

                <!-- Conexiones Futuras -->
                <g class="connections-future" id="futureConnections" style="opacity: 0;">
                    <path d="M550,300 Q600,280 650,300" class="connection-line connection-future" marker-end="url(#arrowhead-green)"/>
                    <path d="M200,210 Q450,180 750,260" class="connection-line connection-future" marker-end="url(#arrowhead-green)"/>
                    <path d="M600,75 Q750,100 900,200" class="connection-line connection-future" marker-end="url(#arrowhead-green)"/>
                    <line x1="750" y1="350" x2="750" y2="370" class="connection-line connection-future"/>
                    <path d="M750,350 Q800,360 850,370" class="connection-line connection-future"/>
                    <path d="M750,350 Q850,360 950,370" class="connection-line connection-future"/>
                </g>

                <!-- Indicadores de flujo de datos -->
                <g class="data-flow" id="dataFlow">
                    <circle r="3" fill="var(--accent-blue)" opacity="0.8">
                        <animateMotion dur="3s" repeatCount="indefinite" path="M140,250 Q90,350 140,530"/>
                    </circle>
                    <circle r="2" fill="var(--accent-red)" opacity="0.6">
                        <animateMotion dur="2s" repeatCount="indefinite" path="M140,250 L140,295"/>
                    </circle>
                </g>

                <!-- Etiquetas de Fases -->
                <g class="phase-labels">
                    <rect x="400" y="450" width="120" height="35" rx="18" style="fill: var(--success-gradient); opacity: 0.9;" filter="url(#shadow)"/>
                    <text x="460" y="472" class="app-text" style="fill: white !important; font-weight: bold; font-size: 12px;">FASE ACTUAL</text>
                    
                    <rect x="1030" y="250" width="120" height="35" rx="18" style="fill: var(--warning-gradient); opacity: 0.9;" filter="url(#shadow)"/>
                    <text x="1090" y="272" class="app-text" style="fill: white !important; font-weight: bold; font-size: 12px;">FASE OBJETIVO</text>
                </g>

                <!-- Grid de monitoreo -->
                <g class="monitoring-grid" id="monitoringGrid" style="opacity: 0;">
                    <defs>
                        <pattern id="grid" width="50" height="50" patternUnits="userSpaceOnUse">
                            <path d="M 50 0 L 0 0 0 50" fill="none" stroke="var(--accent-blue)" stroke-width="0.5" opacity="0.3"/>
                        </pattern>
                    </defs>
                    <rect width="100%" height="100%" fill="url(#grid)"/>
                </g>
            </svg>
        </div>

        <div class="tooltip" id="tooltip"></div>
    </div>

    <script>
        // Credenciales de autenticaci√≥n
        const VALID_CREDENTIALS = {
            username: 'admin',
            password: 'pre@seg@@'
        };

        // Variables globales
        let currentView = 'current';
        let animationQueue = [];
        let isAnimating = false;
        let isAuthenticated = false;
        let loginAttempts = 0;
        const MAX_LOGIN_ATTEMPTS = 3;

        // Sistema de autenticaci√≥n
        class AuthSystem {
            constructor() {
                this.setupEventListeners();
                this.checkSession();
            }

            setupEventListeners() {
                const loginForm = document.getElementById('loginForm');
                const logoutBtn = document.getElementById('logoutBtn');

                loginForm.addEventListener('submit', (e) => this.handleLogin(e));
                logoutBtn.addEventListener('click', () => this.logout());

                // Detectar Enter en campos de entrada
                document.getElementById('username').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        document.getElementById('password').focus();
                    }
                });

                document.getElementById('password').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        loginForm.dispatchEvent(new Event('submit'));
                    }
                });
            }

            async handleLogin(e) {
                e.preventDefault();
                
                if (loginAttempts >= MAX_LOGIN_ATTEMPTS) {
                    this.showError('Demasiados intentos fallidos. Recargue la p√°gina para intentar nuevamente.');
                    return;
                }

                const username = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value;
                const loginBtn = document.getElementById('loginBtn');
                const loginSpinner = document.getElementById('loginSpinner');
                const loginBtnText = document.getElementById('loginBtnText');
                const errorMessage = document.getElementById('errorMessage');

                // Ocultar mensaje de error anterior
                errorMessage.style.display = 'none';

                // Mostrar estado de carga
                loginBtn.classList.add('loading');
                loginBtn.disabled = true;
                loginBtnText.textContent = 'Verificando...';

                try {
                    // Simular validaci√≥n con delay
                    await new Promise(resolve => setTimeout(resolve, 1500));

                    if (this.validateCredentials(username, password)) {
                        this.successfulLogin();
                    } else {
                        this.failedLogin();
                    }
                } catch (error) {
                    console.error('Error en autenticaci√≥n:', error);
                    this.showError('Error interno. Intente nuevamente.');
                } finally {
                    // Restaurar bot√≥n
                    loginBtn.classList.remove('loading');
                    loginBtn.disabled = false;
                    loginBtnText.textContent = 'üöÄ Acceder al Sistema';
                }
            }

            validateCredentials(username, password) {
                return username === VALID_CREDENTIALS.username && password === VALID_CREDENTIALS.password;
            }

            successfulLogin() {
                isAuthenticated = true;
                loginAttempts = 0;
                
                // Guardar sesi√≥n
                sessionStorage.setItem('prevem_auth', 'true');
                sessionStorage.setItem('prevem_login_time', Date.now().toString());
                
                this.showMainApp();
                this.logSecurityEvent('LOGIN_SUCCESS');
            }

            failedLogin() {
                loginAttempts++;
                const remainingAttempts = MAX_LOGIN_ATTEMPTS - loginAttempts;
                
                let errorMsg = 'Usuario o contrase√±a incorrectos.';
                if (remainingAttempts > 0) {
                    errorMsg += ` Intentos restantes: ${remainingAttempts}`;
                } else {
                    errorMsg = 'M√°ximo de intentos alcanzado. Recargue la p√°gina.';
                }
                
                this.showError(errorMsg);
                this.clearPassword();
                this.logSecurityEvent('LOGIN_FAILED');
                
                // Vibraci√≥n en m√≥viles para feedback
                if (navigator.vibrate) {
                    navigator.vibrate([200, 100, 200]);
                }
            }

            showError(message) {
                const errorMessage = document.getElementById('errorMessage');
                errorMessage.innerHTML = `<strong>‚ö†Ô∏è Error de Autenticaci√≥n</strong><br>${message}`;
                errorMessage.style.display = 'block';
                
                // Auto-ocultar despu√©s de 5 segundos
                setTimeout(() => {
                    errorMessage.style.display = 'none';
                }, 5000);
            }

            clearPassword() {
                document.getElementById('password').value = '';
                document.getElementById('password').focus();
            }

            showMainApp() {
                const loginContainer = document.getElementById('loginContainer');
                const diagramContainer = document.getElementById('diagramContainer');
                const securityBadge = document.getElementById('securityBadge');
                const logoutBtn = document.getElementById('logoutBtn');

                // Transici√≥n suave
                loginContainer.classList.add('hidden');
                
                setTimeout(() => {
                    diagramContainer.classList.add('visible');
                    securityBadge.classList.add('authenticated');
                    logoutBtn.classList.add('visible');
                    
                    // Inicializar el diagrama
                    initializeDiagram();
                }, 800);
            }

            logout() {
                if (confirm('¬øEst√° seguro que desea cerrar la sesi√≥n?')) {
                    isAuthenticated = false;
                    
                    // Limpiar sesi√≥n
                    sessionStorage.removeItem('prevem_auth');
                    sessionStorage.removeItem('prevem_login_time');
                    
                    // Resetear interfaz
                    this.showLoginScreen();
                    this.logSecurityEvent('LOGOUT');
                }
            }

            showLoginScreen() {
                const loginContainer = document.getElementById('loginContainer');
                const diagramContainer = document.getElementById('diagramContainer');
                const securityBadge = document.getElementById('securityBadge');
                const logoutBtn = document.getElementById('logoutBtn');

                // Ocultar elementos principales
                diagramContainer.classList.remove('visible');
                securityBadge.classList.remove('authenticated');
                logoutBtn.classList.remove('visible');

                setTimeout(() => {
                    loginContainer.classList.remove('hidden');
                    
                    // Limpiar formulario
                    document.getElementById('username').value = '';
                    document.getElementById('password').value = '';
                    document.getElementById('username').focus();
                    loginAttempts = 0;
                }, 300);
            }

            checkSession() {
                const authStatus = sessionStorage.getItem('prevem_auth');
                const loginTime = sessionStorage.getItem('prevem_login_time');
                
                if (authStatus === 'true' && loginTime) {
                    // Verificar si la sesi√≥n no ha expirado (8 horas)
                    const sessionAge = Date.now() - parseInt(loginTime);
                    const eightHours = 8 * 60 * 60 * 1000;
                    
                    if (sessionAge < eightHours) {
                        isAuthenticated = true;
                        this.showMainApp();
                        return;
                    } else {
                        // Sesi√≥n expirada
                        this.clearSession();
                    }
                }
                
                // Mostrar login si no hay sesi√≥n v√°lida
                document.getElementById('username').focus();
            }

            clearSession() {
                sessionStorage.removeItem('prevem_auth');
                sessionStorage.removeItem('prevem_login_time');
            }

            logSecurityEvent(event) {
                const timestamp = new Date().toISOString();
                const userAgent = navigator.userAgent;
                const ip = 'CLIENT_IP'; // En producci√≥n se obtendr√≠a del servidor
                
                console.log(`[SECURITY] ${timestamp} - ${event} - User Agent: ${userAgent.substring(0, 50)}...`);
                
                // En producci√≥n, enviar al servidor para logging
                // this.sendSecurityLog({ event, timestamp, userAgent, ip });
            }
        }

        // Informaci√≥n detallada de cada componente
        const componentInfo = {
            'prod-server': {
                title: 'üñ•Ô∏è Servidor Producci√≥n X9',
                content: [
                    '‚Ä¢ Modelo: Dell/HP X9 (Actualizado 2024)',
                    '‚Ä¢ CPU: Intel Xeon Silver 4314, 32GB RAM',
                    '‚Ä¢ Storage: SSD NVMe 1TB + HDD 4TB',
                    '‚Ä¢ Funci√≥n: Oracle 19c Producci√≥n',
                    '‚Ä¢ Sistema: Axel Core Business',
                    '‚Ä¢ Uptime: 99.8% (√∫ltimo a√±o)',
                    '‚Ä¢ Load promedio: 65%',
                    '‚Ä¢ Estado: Operativo 24/7',
                    '‚Ä¢ Backup: Diario autom√°tico',
                    '‚Ä¢ Criticidad: CR√çTICA'
                ]
            },
            'dev-server': {
                title: 'üñ•Ô∏è Servidor Desarrollo X9',
                content: [
                    '‚Ä¢ Modelo: Dell/HP X9',
                    '‚Ä¢ CPU: Intel Xeon Bronze 3204, 16GB RAM',
                    '‚Ä¢ Storage: SSD 500GB + HDD 2TB',
                    '‚Ä¢ Ambientes: DEV, QA, TEST, UAT',
                    '‚Ä¢ Base: Oracle 19c segmentada',
                    '‚Ä¢ Uso: Desarrollo y pruebas',
                    '‚Ä¢ Load promedio: 45%',
                    '‚Ä¢ Estado: Operativo horario laboral',
                    '‚Ä¢ Backup: Semanal',
                    '‚Ä¢ Criticidad: MEDIA'
                ]
            },
            'drp-current': {
                title: 'üñ•Ô∏è DRP Actual (X7)',
                content: [
                    '‚Ä¢ Modelo: HP ProLiant DL380 G9 (Legacy)',
                    '‚Ä¢ CPU: Intel Xeon E5-2620 v3, 8GB RAM',
                    '‚Ä¢ Storage: HDD 1TB (limitado)',
                    '‚Ä¢ Ubicaci√≥n: San Jer√≥nimo (25km CDMX)',
                    '‚Ä¢ Funci√≥n: Disaster Recovery',
                    '‚Ä¢ Replicaci√≥n: Oracle Data Guard',
                    '‚Ä¢ RTO estimado: 4-6 horas',
                    '‚Ä¢ RPO: 15 minutos',
                    '‚Ä¢ Limitaci√≥n: Capacidad 40% vs producci√≥n',
                    '‚Ä¢ Estado: Standby activo',
                    '‚Ä¢ Plan: Migrar a Le√≥n Q3 2025'
                ]
            },
            'leon-new': {
                title: 'üéØ Servidores Le√≥n (Nuevo)',
                content: [
                    '‚Ä¢ Modelo: Dell PowerEdge R750 (Deal Polo)',
                    '‚Ä¢ CPU: Intel Xeon Gold 6334, 64GB RAM',
                    '‚Ä¢ Storage: NVMe 2TB + SAS 8TB',
                    '‚Ä¢ Funci√≥n: DRP/BCP Principal',
                    '‚Ä¢ Capacidad: 150% vs actual',
                    '‚Ä¢ Oracle: 19c con r√©plica sincronizada',
                    '‚Ä¢ RTO objetivo: < 30 minutos',
                    '‚Ä¢ RPO objetivo: < 5 minutos',
                    '‚Ä¢ Automatizaci√≥n: Failover completo',
                    '‚Ä¢ Conectividad: Fibra dedicada 1Gbps',
                    '‚Ä¢ Estado: En cotizaci√≥n/planeaci√≥n',
                    '‚Ä¢ Timeline: Q2-Q4 2025'
                ]
            },
            'axel-app': {
                title: 'üíº Sistema Axel',
                content: [
                    '‚Ä¢ Tipo: ERP Core Insurance (Oracle Forms)',
                    '‚Ä¢ Funci√≥n: Emisi√≥n, cotizaci√≥n, cobranza',
                    '‚Ä¢ M√≥dulos: P√≥lizas, endosos, renovaciones',
                    '‚Ä¢ Forms & Reports: 150+ formularios',
                    '‚Ä¢ Base: Oracle 19c (45GB datos)',
                    '‚Ä¢ Usuarios concurrentes: 25-30',
                    '‚Ä¢ Horario: 24/7 (soporte call center)',
                    '‚Ä¢ Integraci√≥n: SOAP/REST APIs',
                    '‚Ä¢ Backup: Tiempo real + snapshot',
                    '‚Ä¢ SLA: 99.5% disponibilidad',
                    '‚Ä¢ Criticidad: CR√çTICA'
                ]
            },
            'insurance-app': {
                title: 'üö® Sistema Insurance (Siniestros)',
                content: [
                    '‚Ä¢ Funci√≥n: Gesti√≥n integral siniestros',
                    '‚Ä¢ Tecnolog√≠a: .NET Core + SQL Server',
                    '‚Ä¢ Tipo: Aplicaci√≥n web responsive',
                    '‚Ä¢ Servidor: Windows Server 2019',
                    '‚Ä¢ Acceso: HTTPS p√∫blico + VPN corporativa',
                    '‚Ä¢ Usuarios: Ajustadores, peritos, call center',
                    '‚Ä¢ Integraci√≥n: APIs con Axel core',
                    '‚Ä¢ Documentos: Azure Blob Storage',
                    '‚Ä¢ Performance: < 2s tiempo respuesta',
                    '‚Ä¢ Backup: Diario autom√°tico',
                    '‚Ä¢ Criticidad: CR√çTICA'
                ]
            },
            'mesa-app': {
                title: 'üìû Mesa de Control',
                content: [
                    '‚Ä¢ Funci√≥n: Control administrativo operativo',
                    '‚Ä¢ Tecnolog√≠a: PHP Laravel + MySQL',
                    '‚Ä¢ Tipo: Sistema web interno',
                    '‚Ä¢ Servidor: Linux Ubuntu + Apache',
                    '‚Ä¢ Acceso: VPN corporativa √∫nicamente',
                    '‚Ä¢ M√≥dulos: Tickets, folios, reportes',
                    '‚Ä¢ Seguimiento: Procesos, tiempos, SLAs',
                    '‚Ä¢ Usuarios: Staff administrativo (8-10)',
                    '‚Ä¢ Horario: Horario laboral',
                    '‚Ä¢ Backup: Semanal',
                    '‚Ä¢ Criticidad: MEDIA'
                ]
            },
            'users-internal': {
                title: 'üë• Usuarios del Sistema',
                content: [
                    '‚Ä¢ Total activos: 45 usuarios',
                    '‚Ä¢ Emisi√≥n y cobranza: 15 usuarios',
                    '‚Ä¢ Siniestros y claims: 12 usuarios',
                    '‚Ä¢ Mesa de control: 8 usuarios',
                    '‚Ä¢ Gerencia y reportes: 10 usuarios',
                    '‚Ä¢ Acceso: VPN/Web seg√∫n aplicaci√≥n',
                    '‚Ä¢ Dispositivos: Windows 10/11 + tablets',
                    '‚Ä¢ Contingencia: Trabajo remoto habilitado',
                    '‚Ä¢ Soporte: Scenario caf√© (Starbucks WiFi)',
                    '‚Ä¢ Capacitaci√≥n DRP: Programada Q2 2025'
                ]
            }
        };

        // Funci√≥n mejorada para cambiar vista con animaciones
        function showView(view) {
            if (!isAuthenticated) return;
            if (isAnimating) return;
            
            isAnimating = true;
            showLoadingOverlay(true);
            
            setTimeout(() => {
                currentView = view;
                updateViewElements(view);
                updateMetrics(view);
                playViewTransition(view);
                
                setTimeout(() => {
                    showLoadingOverlay(false);
                    isAnimating = false;
                }, 800);
            }, 300);
        }

        function updateViewElements(view) {
            const currentConnections = document.getElementById('currentConnections');
            const futureConnections = document.getElementById('futureConnections');
            const siteLeon = document.getElementById('siteLeon');
            const siteCDMX = document.getElementById('siteCDMX');
            const siteSur = document.getElementById('siteSur');
            const phaseIndicator = document.getElementById('phaseIndicator');
            const monitoringGrid = document.getElementById('monitoringGrid');

            // Reset button states
            document.querySelectorAll('.control-btn').forEach(btn => {
                btn.style.opacity = '0.7';
                btn.style.transform = 'scale(1)';
                btn.classList.remove('active');
            });

            // Apply view-specific styles
            switch(view) {
                case 'current':
                    siteCDMX.style.opacity = '1';
                    siteSur.style.opacity = '1';
                    siteLeon.style.opacity = '0.3';
                    currentConnections.style.opacity = '1';
                    futureConnections.style.opacity = '0';
                    monitoringGrid.style.opacity = '0';
                    
                    phaseIndicator.innerHTML = `
                        <div class="phase-current">ESTADO ACTUAL</div>
                        <div style="color: var(--accent-red); font-size: clamp(0.7rem, 1.5vw, 0.9rem); margin-top: 8px; font-weight: 600;">Operaci√≥n en CDMX + DRP San Jer√≥nimo</div>
                    `;
                    
                    document.querySelector('[data-view="current"]').style.opacity = '1';
                    document.querySelector('[data-view="current"]').style.transform = 'scale(1.1)';
                    document.querySelector('[data-view="current"]').classList.add('active');
                    break;

                case 'future':
                    siteCDMX.style.opacity = '0.4';
                    siteSur.style.opacity = '0.3';
                    siteLeon.style.opacity = '1';
                    currentConnections.style.opacity = '0.3';
                    futureConnections.style.opacity = '1';
                    monitoringGrid.style.opacity = '0.2';
                    
                    phaseIndicator.innerHTML = `
                        <div class="phase-future">PLAN OBJETIVO</div>
                        <div style="color: var(--accent-green); font-size: clamp(0.7rem, 1.5vw, 0.9rem); margin-top: 8px; font-weight: 600;">DRP/BCP Completo en Le√≥n</div>
                    `;
                    
                    document.querySelector('[data-view="future"]').style.opacity = '1';
                    document.querySelector('[data-view="future"]').style.transform = 'scale(1.1)';
                    document.querySelector('[data-view="future"]').classList.add('active');
                    break;

                case 'both':
                    siteCDMX.style.opacity = '1';
                    siteSur.style.opacity = '0.7';
                    siteLeon.style.opacity = '1';
                    currentConnections.style.opacity = '0.6';
                    futureConnections.style.opacity = '1';
                    monitoringGrid.style.opacity = '0.3';
                    
                    phaseIndicator.innerHTML = `
                        <div style="background: var(--secondary-gradient); color: white; padding: 12px 20px; border-radius: 25px; font-weight: 700; margin-bottom: 15px; text-align: center; font-size: clamp(0.9rem, 1.8vw, 1.1rem); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);">MIGRACI√ìN COMPLETA</div>
                        <div style="color: var(--accent-purple); font-size: clamp(0.7rem, 1.5vw, 0.9rem); margin-top: 8px; font-weight: 600;">Estado Actual ‚Üí Plan Le√≥n</div>
                    `;
                    
                    document.querySelector('[data-view="both"]').style.opacity = '1';
                    document.querySelector('[data-view="both"]').style.transform = 'scale(1.1)';
                    document.querySelector('[data-view="both"]').classList.add('active');
                    
                    animateFutureConnections();
                    break;
            }
        }

        function updateMetrics(view) {
            const serverCount = document.getElementById('serverCount');
            const appCount = document.getElementById('appCount');
            const connectionCount = document.getElementById('connectionCount');
            const systemStatus = document.getElementById('systemStatus');

            switch(view) {
                case 'current':
                    animateCounter(serverCount, 4);
                    animateCounter(appCount, 3);
                    animateCounter(connectionCount, 7);
                    systemStatus.textContent = 'Operativo';
                    systemStatus.style.color = 'var(--accent-green)';
                    break;
                case 'future':
                    animateCounter(serverCount, 6);
                    animateCounter(appCount, 3);
                    animateCounter(connectionCount, 12);
                    systemStatus.textContent = 'Planeado';
                    systemStatus.style.color = 'var(--accent-orange)';
                    break;
                case 'both':
                    animateCounter(serverCount, 4, 6);
                    animateCounter(appCount, 3);
                    animateCounter(connectionCount, 7, 12);
                    systemStatus.textContent = 'Migraci√≥n';
                    systemStatus.style.color = 'var(--accent-purple)';
                    break;
            }
        }

        function animateCounter(element, startValue, endValue = null) {
            const end = endValue || startValue;
            const start = parseInt(element.textContent) || 0;
            const duration = 1000;
            const startTime = performance.now();

            function updateCounter(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const current = Math.round(start + (end - start) * progress);
                
                element.textContent = endValue ? `${current}‚Üí${end}` : current;
                
                if (progress < 1) {
                    requestAnimationFrame(updateCounter);
                }
            }
            
            requestAnimationFrame(updateCounter);
        }

        function animateFutureConnections() {
            const futureLines = document.querySelectorAll('#futureConnections .connection-line');
            futureLines.forEach((line, index) => {
                line.style.strokeDasharray = '1000';
                line.style.strokeDashoffset = '1000';
                line.style.animation = `drawLine 2s ease-in-out ${index * 0.3}s forwards`;
            });
        }

        function showLoadingOverlay(show) {
            const overlay = document.getElementById('loadingOverlay');
            if (show) {
                overlay.classList.add('active');
            } else {
                overlay.classList.remove('active');
            }
        }

        // Funciones de interactividad
        function showInfo(infoKey) {
            if (!isAuthenticated) return;
            
            const info = componentInfo[infoKey];
            if (info) {
                const infoPanel = document.getElementById('infoPanel');
                const infoTitle = document.getElementById('infoTitle');
                const infoContent = document.getElementById('infoContent');
                
                infoTitle.textContent = info.title;
                infoContent.innerHTML = info.content.map(item => `<p>${item}</p>`).join('');
                infoPanel.style.display = 'block';
                infoPanel.style.animation = 'slideInUp 0.3s ease-out';
            }
        }

        function hideInfo() {
            const infoPanel = document.getElementById('infoPanel');
            infoPanel.style.animation = 'slideOutDown 0.3s ease-in';
            setTimeout(() => {
                infoPanel.style.display = 'none';
            }, 300);
        }

        // Inicializaci√≥n del diagrama
        function initializeDiagram() {
            setupInteractivity();
            setupKeyboardShortcuts();
            showView('current');
            
            // Efectos de entrada escalonados
            setTimeout(() => {
                document.querySelectorAll('.server-group, .app-circle').forEach((element, index) => {
                    element.style.opacity = '0';
                    element.style.transform = 'translateY(20px)';
                    element.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                    
                    setTimeout(() => {
                        element.style.opacity = '1';
                        element.style.transform = 'translateY(0)';
                    }, index * 150);
                });
            }, 200);
        }

        // Event listeners mejorados
        function setupInteractivity() {
            document.querySelectorAll('[data-info]').forEach(element => {
                // Mouse events para desktop
                element.addEventListener('mouseenter', (e) => {
                    if (window.matchMedia('(hover: hover)').matches) {
                        const infoKey = e.target.closest('[data-info]').getAttribute('data-info');
                        showInfo(infoKey);
                        element.style.filter = 'brightness(1.1) drop-shadow(0 8px 25px rgba(0, 0, 0, 0.3))';
                    }
                });

                element.addEventListener('mouseleave', (e) => {
                    if (window.matchMedia('(hover: hover)').matches) {
                        hideInfo();
                        element.style.filter = '';
                    }
                });

                // Touch events para m√≥vil
                element.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    const infoKey = e.target.closest('[data-info]').getAttribute('data-info');
                    showInfo(infoKey);
                    
                    // Feedback h√°ptico si est√° disponible
                    if (navigator.vibrate) {
                        navigator.vibrate(50);
                    }
                });

                // Click para interacci√≥n alternativa
                element.addEventListener('click', (e) => {
                    if (window.matchMedia('(hover: none)').matches) {
                        e.preventDefault();
                        const panel = document.getElementById('infoPanel');
                        if (panel.style.display === 'block') {
                            hideInfo();
                        } else {
                            const infoKey = e.target.closest('[data-info]').getAttribute('data-info');
                            showInfo(infoKey);
                        }
                    }
                });
            });
        }

        // Keyboard shortcuts mejorados
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                if (!isAuthenticated) return;
                
                // Prevenir shortcuts si hay un modal abierto
                if (document.getElementById('infoPanel').style.display === 'block' && e.key === 'Escape') {
                    hideInfo();
                    return;
                }
                
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case 's':
                            e.preventDefault();
                            exportDiagram('png');
                            break;
                        case 'e':
                            e.preventDefault();
                            exportDiagram('svg');
                            break;
                    }
                }
                
                // Navegaci√≥n r√°pida
                switch(e.key) {
                    case '1':
                        showView('current');
                        break;
                    case '2':
                        showView('future');
                        break;
                    case '3':
                        showView('both');
                        break;
                    case 'l':
                        if (e.ctrlKey) {
                            e.preventDefault();
                            authSystem.logout();
                        }
                        break;
                }
            });
        }

        // Funciones de exportaci√≥n
        function exportDiagram(format = 'png') {
            if (!isAuthenticated) return;
            
            showLoadingOverlay(true);
            
            setTimeout(() => {
                const svg = document.querySelector('.diagram-svg');
                const svgData = new XMLSerializer().serializeToString(svg);
                
                if (format === 'svg') {
                    downloadSVG(svgData);
                } else {
                    exportToPNG(svgData);
                }
                
                showLoadingOverlay(false);
            }, 500);
        }

        function exportToPNG(svgData) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            canvas.width = 1600;
            canvas.height = 1000;
            
            img.onload = function() {
                // Fondo blanco
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Dibujar SVG
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                
                // Agregar marca de agua
                ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
                ctx.font = '16px Inter';
                ctx.textAlign = 'right';
                ctx.fillText(`Prev√©n - ${currentView.toUpperCase()} - ${new Date().toLocaleDateString()}`, 
                            canvas.width - 20, canvas.height - 20);
                
                const pngFile = canvas.toDataURL('image/png', 0.95);
                
                const downloadLink = document.createElement('a');
                downloadLink.download = `Arquitectura_Preven_${currentView}_${Date.now()}.png`;
                downloadLink.href = pngFile;
                downloadLink.click();
            };
            
            img.src = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgData)));
        }

        function downloadSVG(svgData) {
            const blob = new Blob([svgData], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            
            const downloadLink = document.createElement('a');
            downloadLink.download = `Arquitectura_Preven_${currentView}_${Date.now()}.svg`;
            downloadLink.href = url;
            downloadLink.click();
            
            URL.revokeObjectURL(url);
        }

        function playViewTransition(view) {
            const elements = document.querySelectorAll('.server-group, .app-circle');
            elements.forEach((element, index) => {
                element.style.animation = `fadeInScale 0.6s ease ${index * 0.1}s both`;
            });
        }

        // Variable global para el sistema de autenticaci√≥n
        let authSystem;

        // Funciones globales exportadas
        window.showView = showView;
        window.exportDiagram = exportDiagram;
        window.hideInfo = hideInfo;

        // Inicializaci√≥n principal
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîê Sistema Seguro - Diagrama Interactivo Prev√©m');
            
            // Inicializar sistema de autenticaci√≥n
            authSystem = new AuthSystem();
            
            // Click fuera del panel para cerrar
            document.addEventListener('click', function(e) {
                if (!isAuthenticated) return;
                
                const infoPanel = document.getElementById('infoPanel');
                const isClickInside = infoPanel.contains(e.target) || e.target.closest('[data-info]');
                
                if (!isClickInside && infoPanel.style.display === 'block') {
                    hideInfo();
                }
            });

            // Protecci√≥n contra inspecci√≥n de c√≥digo (b√°sica)
            document.addEventListener('keydown', function(e) {
                if (e.key === 'F12' || 
                    (e.ctrlKey && e.shiftKey && e.key === 'I') ||
                    (e.ctrlKey && e.shiftKey && e.key === 'C') ||
                    (e.ctrlKey && e.key === 'U')) {
                    e.preventDefault();
                    console.warn('üö´ Acceso restringido para proteger informaci√≥n sensible');
                    return false;
                }
            });

            // Protecci√≥n contra click derecho
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                console.warn('üö´ Click derecho deshabilitado por seguridad');
                return false;
            });

            // Detecci√≥n de cambio de pesta√±a/ventana
            document.addEventListener('visibilitychange', function() {
                if (document.visibilityState === 'hidden' && isAuthenticated) {
                    console.log('üîç Pesta√±a oculta - Sesi√≥n monitoreada');
                }
            });

            // Auto-logout por inactividad (30 minutos)
            let inactivityTimer;
            const INACTIVITY_TIME = 30 * 60 * 1000; // 30 minutos

            function resetInactivityTimer() {
                clearTimeout(inactivityTimer);
                if (isAuthenticated) {
                    inactivityTimer = setTimeout(() => {
                        alert('Sesi√≥n cerrada por inactividad');
                        authSystem.logout();
                    }, INACTIVITY_TIME);
                }
            }

            // Detectar actividad del usuario
            ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart', 'click'].forEach(event => {
                document.addEventListener(event, resetInactivityTimer, true);
            });

            console.log('üí° Comandos disponibles (solo despu√©s del login):');
            console.log('- Teclas 1,2,3: Cambiar vista');
            console.log('- Ctrl+S: Exportar PNG');
            console.log('- Ctrl+E: Exportar SVG');
            console.log('- Ctrl+L: Logout');
            console.log('- Esc: Cerrar paneles');
        });

        // CSS adicional para animaciones
        const additionalStyle = document.createElement('style');
        additionalStyle.textContent = `
            @keyframes fadeInScale {
                from {
                    opacity: 0;
                    transform: scale(0.8) translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: scale(1) translateY(0);
                }
            }
            
            @keyframes drawLine {
                to {
                    stroke-dashoffset: 0;
                }
            }
            
            @keyframes slideOutDown {
                from {
                    opacity: 1;
                    transform: translateY(0);
                }
                to {
                    opacity: 0;
                    transform: translateY(20px);
                }
            }
        `;
        document.head.appendChild(additionalStyle);

        // Protecci√≥n adicional: Ofuscar credenciales en memoria
        (function() {
            const originalCredentials = VALID_CREDENTIALS;
            setTimeout(() => {
                // No modificar las credenciales reales, solo agregar ruido en la consola
                window.fakeCredentials = {
                    username: 'demo',
                    password: 'demo123',
                    admin: 'administrator',
                    pass: 'password123'
                };
            }, 5000);
        })();
    </script>
</body>
</html>
